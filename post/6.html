<!doctype html><html><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/><title>JS实现自定义数学运算</title><link href="/css/main.css" rel="stylesheet"/><script src="/js/blog.js"></script></head><body><div id="post">
	<section id="main">
		<h2 class="title">JS实现自定义数学运算</h2>
		<div class="post"><h3>前言</h3><p>本次以数学运算为例子，用JS写一个集词法分析，语法分析，代码解释这样一个演示全过程的例子。</p><h3>约定</h3><h4>运算符</h4><ol><li>加，减『+，-』</li><li>乘，除『*,/』</li><li>乘方『^』</li></ol><h4>运算元</h4><ol><li>整数</li></ol><h3>演示</h3><p>待执行的数学表达式：<input id="mathcode" value="1+2^3*4+51^5*6*5^6+71-7-8" style="width:300px;padding:3px;"/><button id="runbtn">执行分析</button></p><div>执行结果：<span id="result" style="color:red">...</span></div><h4>数学表达式</h4><div style="border:1px dashed #ccc;" id="mathresult"></div><div class="olbox"><h4>词法单元</h4><ul id="cfdy" style="border:1px dashed #ccc;"></ul></div><h4>语法树</h4><p class="xinfo">语法树中,a和b为运算元，o为运算符，{}中的内容为优先运算。</p><div style="border:1px dashed #ccc;" id="syntaxtree"></div><script>!function(b){b('#runbtn').click(function(){var c=parse(b('#mathcode').val()),d=syntax(c);var a=explan(d);b('#result').html(a);var f=[];b.each(c,function(e){if(e.py){f.push('<li>\u8FD0\u7B97\u7B26\uFF1A<span style="color:red">'+e.val+'</span></li>')}else{f.push('<li>\u8FD0\u7B97\u5143\uFF1A'+e.val+'</li>')}});b('#cfdy').html(f.join(''));b('#syntaxtree').html(b.toJson(d));b('#mathresult').html(b.toJson(d).replace(/[":,a,b,o]/g,'').replace(/\{/g,' ( ').replace(/\}/g,' ) '))})}($1k);function parse(b){var h=[];b.replace(/(\^)|(\*|\/)|(\+|-)|(\d+)/g,function(e,c,d,a,f){switch(!1){case!c:h.push({py:3,val:c});break;case!d:h.push({py:2,val:d});break;case!a:h.push({py:1,val:a});break;case!f:h.push({vart:1,val:f});break}});return h}function syntax(e){var c,d=[],a,f,b=0,h;while(a=e[b]){if(a.py){f=e[b+2]?e[b+2].py:1;if(a.py==f){c={a:c?c:e[b-1].val,o:a.val,b:e[b+1].val}}else if(a.py>f){c={a:c?c:e[b-1].val,o:a.val,b:e[b+1].val};for(var g=d.length-1;g>f-1;g--){d[g].push(c);d[g][0].b=d[g][1];c=d[g][0];d.splice(g,1)}}else{d[a.py]=[{a:c?c:e[b-1].val,o:a.val}];c=null}b+=2}else{b++}}return c}function explan(a){if(typeof a=='object'){switch(a.o){case'+':return explan(a.a)+explan(a.b);case'-':return explan(a.a)-explan(a.b);case'*':return explan(a.a)*explan(a.b);case'/':return explan(a.a)/explan(a.b);case'^':return function(e,c){var d=1;while(c--){d*=e}return d}(explan(a.a),explan(a.b))}}else{return+a}}</script></div>
	</section>
</div></body></html>